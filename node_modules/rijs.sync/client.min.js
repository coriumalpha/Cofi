var sync=function(){"use strict";function n(n){return function(t){return t==n}}function t(n){return function(t){return b(t)(n)}}function e(n,t,r,i){var u=r.shift();if(!z[t])return!1;if(r.length){if(!(u in n)){if("remove"==t)return!0;n[u]={}}return e(n[u],t,r,i)}return z[t](n,u,i),!0}var r=function(){var n,t,e=new Promise(function(e,r){n=e,t=r});return arguments.length&&n(arguments[0]),e.resolve=n,e.reject=t,e},i=function n(t,e){return e instanceof Array&&(e=e.reduce(n,[])),(t=t||[]).concat(e)},u=function(n,t,e,r){return n.host&&n.host.nodeName&&(n=n.host),t.name&&(e=t,t=t.name),!function(n,t){return t in n}(n,t)&&Object.defineProperty(n,t,{value:e,writable:r}),n[t]},o=function n(t){function e(n,e){return n.next?n.next(e):e instanceof Array?n.apply(t,e):n.call(t,e)}function o(n,t){for(var e=n.length;~--e;)t!=n[e]&&t!=n[e].fn&&t||n.splice(e,1)}function c(t,e){var i=n((e=e||{}).base||r());return i.i=0,i.li=[],i.fn=e.fn,i.parent=t,i.source=e.fn?i.parent.source:i,i.on("stop",function(){return i.type?i.parent.off(i.type,i):i.parent.off(i)}),i.each=function(n){var t=n.next?n:c(i,{fn:n});return i.li.push(t),t},i.pipe=function(n){return n(i)},i.map=function(n){return i.each(function(t,e,r){return r.next(n(t,e,r))})},i.filter=function(n){return i.each(function(t,e,r){return n(t,e,r)&&r.next(t)})},i.reduce=function(n,t){return i.each(function(e,r,i){return i.next(t=n(t,e,r,i))})},i.unpromise=function(){var n=c(i,{base:{},fn:function(t){return n.next(t)}});return i.li.push(n),n},i.next=function(n){return i.resolve&&i.resolve(n),i.li.length?i.li.map(function(t){return t.fn(n,t.i++,t)}):n},i.until=function(n){return n.each(function(){i.source.emit("stop")}),i},i.off=function(n){return o(i.li,n),i},i[Symbol.asyncIterator]=function(){return{next:function(){return i.wait=new Promise(function(n){i.wait=!0,i.map(function(t,e,r){delete i.wait,i.off(r),n({value:t,done:!1})}),i.emit("pull",i)})}}},i}return t=t||{},u(t,"emit",function(n,r,u){for(var o=t.on[n.split(".")[0]]||[],c=[],f=0;f<o.length;f++)o[f].ns&&u&&!u(o[f].ns)||c.push(e(o[f].isOnce?o.splice(f--,1)[0]:o[f],r));for(f=0;f<t.on["*"].length;f++)c.push(e(t.on["*"][f],[n,r]));return c.reduce(i,[])},1),u(t,"once",function(n,e){return t.on(n,e,!0)},1),u(t,"off",function(n,e){return o(t.on[n]||[],e),e&&e.ns&&delete t.on[n]["$"+e.ns],t},1),u(t,"on",function(n,e,r){function i(n){return n.isOnce=r,n.type=u,f&&(t.on[u]["$"+(n.ns=f)]=n),a.push(n),n.next?n:t}var u=n.split(".")[0],f=n.split(".")[1],a=t.on[u]=t.on[u]||[],s="function"==typeof e?e:0;return!s&&f?(s=t.on[u]["$"+f])?s:i(c(t,e)):s||f?s&&f?i((o(a,t.on[u]["$"+f]||-1),s)):!(!s||f)&&i(s):i(c(t,e))},1),t.on["*"]=t.on["*"]||[],t},c=Math.min,f=Math.pow,a=function(n,t){return function(){var e=window.WebSocket,r=window.setTimeout,i=new e(t);i.onopen=function(){return n.emit("connected",i)},i.onmessage=function(t){return n.emit("recv",t.data)},i.onclose=function(){n.ready=n.once("connected"),n.emit("disconnected"),r(n.connect,s(++n.attempt))}}},s=function(n,t,e){return void 0===t&&(t=100),void 0===e&&(e=1e4),c(e,t*f(2,n))},p=n;n.fn=function(n){return"function"==typeof n},n.str=function(n){return"string"==typeof n},n.num=function(n){return"number"==typeof n},n.obj=function(n){return"object"==typeof n},n.lit=function(n){return n.constructor==Object},n.bol=function(n){return"boolean"==typeof n},n.truthy=function(n){return 1==!!n},n.falsy=function(n){return 0==!!n},n.arr=function(n){return n instanceof Array},n.null=function(n){return null===n},n.def=function(n){return void 0!==n},n.in=function(n){return function(t){return!!n&&(n.indexOf?~n.indexOf(t):t in n)}},n.promise=function(n){return n instanceof Promise},n.stream=function(n){return!(!n||!n.next)};var l=function(n){return Object.keys(p.obj(n)||p.fn(n)?n:{})},d=function(n){return n.__data__},m=function(n){return function(){return n}},v=function(n){return 0===n?"0":n?p.fn(n)?""+n:p.obj(n)?JSON.stringify(n):String(n):""},b=function n(t,e){var r=arguments.length>1,i=p.fn(t)?[]:v(t).split("."),u=i.shift();return function(o,c){var f={};return o?p.num(t)||t?p.arr(t)?(t.map(function(t){var e=n(t)(o);void 0!=e&&n(t,p.fn(e)?m(e):e)(f)}),f):o[t]||!i.length?r?(o[t]=p.fn(e)?e(o[t],c):e,o):p.fn(t)?t(o):o[t]:r?(n(i.join("."),e)(o[u]?o[u]:o[u]={}),o):n(i.join("."))(o[u]):o:void 0}},y=t;t.parent=function(n){return d(this.parentNode)[n]};var h=function(n){return n?l(n).map(y(n)):[]},g=function(n){void 0===n&&(n={});var t=n.socket;return void 0===t&&(t=function(n){void 0===n&&(n=location.href.replace("http","ws"));var t=o({attempt:0});return t.ready=t.once("connected"),t.connect=a(t,n),t.connect(),t.send=function(n){return t.ready.then(function(t){return t.send(n)})},t}()),t.id=0,t.once("disconnected").map(function(){return t.on("connected").map(O(t))}),t.on("recv").map(function(n){return _(n)}).each(function(n){var e=n.id,r=n.data;return r.exec?r.exec(t.on["$"+e]&&t.on["$"+e][0],r.value):t.emit("$"+e,r)}),Object.defineProperty(w(t),"subscriptions",{get:function(){return x(t)}})},x=function(n){return h(n.on).map(function(n){return n&&n[0]}).filter(function(n){return n&&n.type&&"$"==n.type[0]})},O=function(n){return function(){return x(n).map(function(n){return n.type}).map(function(t){return n.send(n.on[t][0].subscription)})}},_=function(n,t){return t={exports:{}},n(t,t.exports),t.exports}(function(n){!function(){function t(n){return"object"==typeof n?null===n?"null":n&&1===n.nodeType?"dom":n instanceof Array?"array":n instanceof Date?"date":"object":typeof n}function e(n){var t=arguments,e=arguments.length;if(e<2||null==n)return n;for(var r=1;r<e;r++)for(var i=t[r],u=Object.keys(i),o=u.length,c=0;c<o;c++){var f=u[c];void 0===n[f]&&(n[f]=i[f])}return n}function r(n,e,i,o){i.prepare&&i.prepare(n),o=o||[];var a=t(n);if(-1!==c.indexOf(a)){var s=o.indexOf(n);if(-1===s){var p={};o[s=e.push({contents:p,value:function(n){var e=t(n);if("function"===e||"date"===e)return u(n);if("object"===e)return d;if("array"===e)return m;return n}(n)})-1]=n;for(var l in n)i.isSerializable(n,l)&&(p[l]=r(n[l],e,i,o))}return f+s}return u(n)}function i(n,e,r,u){if(u=u||[],o(n,f)){var c=parseInt(n.slice(f.length),10);if(!u.hasOwnProperty(c)){var v=e[c],b=function(n){if("string"===t(n)){if(n===p)return;if(o(n,s))return new Function("return "+n.slice(s.length))();if(o(n,l)){var e=parseInt(n.slice(l.length),10);return new Date(e)}if(o(n,d))return{};if(o(n,m))return[];if(n===a)return 1/0}return n}(v.value),y=v.contents;u[c]=b;for(var h in y)b[h]=i(y[h],e,r,u)}return r.finalize&&r.finalize(u[c]),u[c]}return r.finalize&&r.finalize(n),function(n){if("string"===t(n)){if(n===p)return;if(o(n,s)){var e=n.slice(s.length),r=e.indexOf("(")+1,i=e.indexOf(")",r),u=e.slice(r,i),c=e.indexOf("{")+1,f=e.lastIndexOf("}")-1,d=e.slice(c,f);return new Function(u,d)}if(o(n,l)){var m=parseInt(n.slice(l.length),10);return new Date(m)}if(n===a)return 1/0}return n}(n)}function u(n){var e=t(n);if("undefined"===e)return p;if("function"===e)return s+n.toString();if("date"===e)return l+n.getTime();if(n===1/0)return a;if("dom"!==e)return n}function o(n,e){return"string"===t(n)&&n.slice(0,e.length)===e}var c="object array date function".split(" "),f="_CRYO_REF_",a="_CRYO_INFINITY_",s="_CRYO_FUNCTION_",p="_CRYO_UNDEFINED_",l="_CRYO_DATE_",d="_CRYO_OBJECT_",m="_CRYO_ARRAY_",v={stringify:function(n,t){var i=[],u=r(n,i,t=e((t="function"==typeof t?{prepare:t}:t)||{},{prepare:null,isSerializable:function(n,t){return n.hasOwnProperty(t)}}));return JSON.stringify({root:u,references:i})},parse:function(n,t){var r=JSON.parse(n);return t="function"==typeof t?{finalize:t}:t,t=e(t||{},{finalize:null}),i(r.root,r.references,t)}},b=this;n.exports?n.exports=v:b.Cryo=v}()}).parse,w=function(n,t){return function(e,r){if(e instanceof window.Blob)return j(n,e,r);var i=v(++n.id),u=n.on("$"+i),o=function(e,r){return void 0===r&&(r=0),n.send(u.source.subscription=v({id:i,data:e,type:t})).then(function(){return u.emit("sent",{id:i,count:r})})};return e.next?e.map(o).source.emit("start"):o(e),u.source.once("stop").filter(function(n){return"CLOSED"!=n}).map(function(){return w(n,"UNSUBSCRIBE")(i).filter(function(n,t,e){return e.source.emit("stop","CLOSED")})}),u}},j=function(n,t,e,r,i){void 0===r&&(r=0),void 0===i&&(i=1024);var u=o().on("recv"),c=function(e){return function(){return r>=t.size?u.emit("sent",{id:e}):(n.send(t.slice(r,r+=i)),window.setTimeout(c(e)))}};return w(n,"BINARY")({size:t.size,meta:e}).on("sent",function(n){var t=n.id;return c(t)()}).on("progress",function(n){return u.emit("progress",{received:n,total:t.size})}).map(u.next).source.until(u.once("stop")),u},S={arr:function(n){return Array.prototype.slice.call(n,0)},obj:function(n){function t(n,t,r){return 0===r&&(n={}),n[p.fn(e)?e(t,r):t[e]]=t,n}var e="id";return 1==arguments.length?(e=n,t):t.apply(this,arguments)}},z={add:function(n,t,e){p.arr(n)?n.splice(t,0,e):n[t]=e},update:function(n,t,e){n[t]=e},remove:function(n,t){p.arr(n)?n.splice(t,1):delete n[t]}},N=JSON.stringify,C=JSON.parse,R=function(n){return function(){return!n.apply(this,arguments)}},I=function(n){return function(t,e,r){return t instanceof Blob?n(t,e):n(p.obj(t)?t:{name:t,type:e,value:r})}},P=function(n){return function(t,e){if(n.subscriptions[t]=n.subscriptions[t]||{},p.arr(e))return Promise.all(e.map(function(e){return n.get(t,e)}));var r=b(e)(b("resources."+t+".body")(n));return e in n.subscriptions[t]&&r?Promise.resolve(r):n.subscribe(t,e).filter(function(n,t,e){return e.source.emit("stop")}).map(function(){return b(e)(b("resources."+t+".body")(n))})}},A=function(n,t){return function(r){return r.key||"update"!=r.type?function(n,t){return function(r,i,c){if(!p.obj(r)&&!p.fn(r))return r;if(!p.obj(n)){var f=i||r.log||[],a=r;if(p.def(c)||(c=f.max||0),c||(f=[]),c<0&&(f=f.concat(null)),c>0){var s=N(r);a=C(s),f=f.concat({type:"update",value:C(s),time:f.length})}return u(f,"max",c),a.log?a.log=f:u(o(a),"log",f,1),a}return!!p.def(n.key)&&!!e(r,n.type,(n.key=""+n.key).split("."),n.value)&&(r.log&&r.log.max&&r.log.push((n.time=r.log.length,r.log.max>0?n:null)),!t&&r.emit&&r.emit("change",n),r)}}(r)(t in n.resources?n(t):n(t,{})):n(D(function(n){return function(t){return l(t).filter(R(p.in(n))).map(function(n,t){return function(e){return t[e]=n[e],e}}(t,n)),n}}({name:t})(r))),r}},E=function(n){var t=o().on("next"),e=[];return n.map(function(n,r){return n.each(function(n){e[r]=n,t.next(e)})}),t.once("stop").map(function(){return n.map(function(n){return n.source.emit("stop")})}),t},Y=function(n){return function(t,e){if(p.arr(t))return E(t.map(function(t){return n.subscribe(t,e)}));if(n.subscriptions[t]=n.subscriptions[t]||{},p.arr(e))return E(e.map(function(e){return n.subscribe(t,e)})).map(function(){return b(e)(n(t))});var r=o().on("next");r.on("stop").filter(function(){return i.off(r.next)&&!i.li.length}).map(function(){return i.source.emit("stop")}).map(function(){n.subscriptions[t][e]=void 0}),n.subscriptions[t][e]&&r.on("start").map(function(){return b(e)(n(t))}).filter(p.def).map(function(n){return r.next(n)});var i=n.subscriptions[t][e]=n.subscriptions[t][e]||n.send(t,"SUBSCRIBE",e).map(A(n,t)).map(function(){return b(e)(n(t))});return i.each(r.next),r}},B=function(n){return function(t,e){var r=++n.upload.id,u={},o=0,c=function(){if(!f.length)return!0;var t=f.shift(),e=t.field,i=t.filename,u=t.i,s=t.blob;return n.send(s,{filename:i,field:e,i:u,index:r}).on("progress",function(n){var t=n.received;return a.emit("progress",{total:o,received:o-(s.size-t)-f.reduce(function(n,t){return n+=t.blob.size},0)})}).then(c)},f=l(e).map(function(n){return u[n]=e[n],n}).filter(function(n){return e[n]instanceof FileList}).map(function(n){return u[n]=[],S.arr(e[n]).map(function(n){return o+=n.size,n}).map(function(t,e){return{field:n,filename:t.name,i:e,blob:t,sent:0}})}).reduce(i,[]),a=n.send({files:f.length,type:"PREUPLOAD",fields:u,index:r,size:o,name:t}).once("sent",c);return a}},D=function(n){var t=n.name,e=n.value;return{name:t,headers:n.headers,body:e}},$=function(n){return function(t){return function(e){return!n.deps(e).filter(R(p.in(n.subscriptions))).map(function(t){return n.subscribe(t)}).length&&t(e)}}},k=function(n){return function(t){return h(n.types).filter(function(n){return n.extract}).map(function(n){return n.extract(t)}).reduce(function(n,t){return n.concat(t)},[]).filter(Boolean)}};return function(n,t,e){void 0===t&&(t={}),void 0===e&&(e={});var r=e.xrs;return void 0===r&&(r=g),n.send=I(r()),n.subscribe=Y(n),n.subscriptions={},n.get=P(n),n.upload=B(n),n.upload.id=0,n.render=$(n)(n.render),n.deps=k(n),n}}();
